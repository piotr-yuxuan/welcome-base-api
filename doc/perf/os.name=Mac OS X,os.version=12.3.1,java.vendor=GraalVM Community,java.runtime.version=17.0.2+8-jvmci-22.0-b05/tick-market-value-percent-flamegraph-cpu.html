<html>
  <head>
    <style>
      body {margin: 0; padding: 5px; background-color: #ffffff}
      button {font: 12px sans-serif;}
      p {margin: 5px 0 5px 0}
      #hl {position: absolute; display: none; overflow: hidden; white-space: nowrap; pointer-events: none; background-color: #00000000; outline: 0.5px solid #222; height: 15px}
      #hl span {padding: 0 3px 0 3px}
      #status {overflow: hidden; white-space: nowrap}
      #match {overflow: hidden; white-space: nowrap; display: none; float: right; text-align: right}
      * {box-sizing:border-box,margin:.25em 0}
      .col{display:table-cell}
      .col-1{width:5%}
      .col-2{width:15%}
      .col-3{width:22%}
      .col-4{width:30%}
      .col-5{width:40%}
      .col-6{width:50%}
      .row{display:table;border-spacing:0.2em 0;width:100%;display:flex}
      .w-100{width:100%;display:flex}
      .graphCol{flex: 80%; padding: 0.25em;}
      .configCol{flex: 20%; padding: 0.25em;}
      .configBlock{position:fixed; overflow-y:auto; top: 5px; bottom: 5px; width:19%;}
      .sidebarToggle{font: 10px; width:10; padding:0;}
      .margins {margin: 5px 1px}
      .vmargins {margin: 0px 1px;}
    </style>
  </head>
  <body style='font: 12px Verdana, sans-serif'>
    <div class="c">
      <div class="row">
        <div class="graphCol">
          <canvas id='canvas' style='width: 100%;'></canvas>
          <div id='box'><div id='hl'><span></span></div></div>
          <p id='match'>Matched: <span id='matchedLabel'></span></p>
          <p id='status'>&nbsp;</p>
        </div>
        <button class="sidebarToggle" onclick="toggleSidebarVisibility()">&lt;</button>
        <div class="configCol">
          <div class="configBlock">
            <div class="row">
              <label for="highlightInput">Highlight:</label>
              <input placeholder="String or /regex/" name="highlightInput" id="highlightInput"/>
            </div>
            <div class="row">
              <button onclick="highlightApply()">Highlight</button>
              <button onclick="highlightClear()">Clear</button>
            </div>
            <br>
            <hr>
            <br>

            <label>Minimal frame width (in pixels):</label><br>
            <input id="minFrameWidthInPx" value="0.25"/><br>
            <div>
              <label><input type="checkbox" id="isReversedInput">Reversed</label>
              <span id="isNormalizedDiv" style="display:none;">
                <label><input type="checkbox" id="isNormalized" name="isNormalized" checked>Normalized</label>
              </span>
            </div>
            <div>
              <label><input type="radio" id="sortByNameRadio" name="sortBy" value="name" checked>Sort by name</label>
              <label><input type="radio" id="sortByWidthRadio" name="sortBy" value="width">Sort by width</label>
            </div>
            <br>

            <div class="row">
              <div class="col">
                <label for="newTransformType">Add a transform:</label>

                <select name="newTransformType" id="newTransformType">
                  <option value="filter">Filter</option>
                  <option value="remove">Remove</option>
                  <option value="replace">Replace</option>
                </select>
              </div>
              <div class="col col-2">
                <button onclick="addNewTransform()">Add</button>
              </div>
            </div>
            <br>

            <div id="transformsContainer">
            </div>

            <div id="transformReplaceTemplate" style="display:none">
              <div class="row">
                <div class="col col-3">
                  <label>Replace:</label><br>
                </div>
                <div class="col">
                  <input type="checkbox" class="chkEnabled" onclick="refreshAfterEnabledToggle()" checked>
                  <button class="minibtn btnMoveUp" title="Move up" onclick="moveTransformUp(this)">↑</button>
                  <button class="minibtn btnMoveDown" title="Move down" onclick="moveTransformDown(this)">↓</button>
                  <button class="minibtn btnClone" title="Clone" onclick="cloneTransform(this)">☍</button>
                  <button class="minibtn btnDelete" title="Delete" onclick="deleteTransform(this)">✖</button>
                </div>
              </div>
              <div class="row" style="margin-top:1px;margin-bottom:1px">
                <div class="col w-100 no-vmargins">
                  <input class="what no-vmargins w-100" placeholder="String or /regex/"/><br>
                </div>
              </div>
              <div class="row" style="margin-top:1px;margin-bottom:1px">
                <div class="col w-100 no-vmargins">
                  <input class="replacement no-vmargins w-100" placeholder="Replacement"/><br>
                </div>
              </div>
            </div>

            <div id="transformFilterTemplate" style="display:none" class="margins">
              <div class="row">
                <div class="col col-3">
                  <label class="label">Filter:</label><br>
                </div>
                <div class="col">
                  <input type="checkbox" class="chkEnabled" onclick="refreshAfterEnabledToggle()" checked>
                  <button class="minibtn btnMoveUp" title="Move up" onclick="moveTransformUp(this)">↑</button>
                  <button class="minibtn btnMoveDown" title="Move down" onclick="moveTransformDown(this)">↓</button>
                  <button class="minibtn btnClone" title="Clone" onclick="cloneTransform(this)">☍</button>
                  <button class="minibtn btnDelete" title="Delete" onclick="deleteTransform(this)">✖</button>
                </div>
              </div>
              <div class="row">
                <div class="col w-100 margins">
                  <input class="what margins w-100" placeholder="String or /regex/"/><br>
                </div>
              </div>
            </div>

            <hr>
            <button onclick="applyConfiguration()">Apply</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      // This file was derived from flamegraph.html from the project
// https://github.com/jvm-profiling-tools/async-profiler
// Licensed under the Apache License, Version 2.0. Copyright 2020 Andrei Pangin

/// Constants
const canvas = document.getElementById('canvas');
const c = canvas.getContext('2d');
const hl = document.getElementById('hl');
const status = document.getElementById('status');
const matchContainer = document.getElementById('match');
const transformFilterTemplate = document.getElementById('transformFilterTemplate');
const transformReplaceTemplate = document.getElementById('transformReplaceTemplate');
const sidebarToggleButton = document.getElementsByClassName('sidebarToggle')[0];
const sidebarWidth = document.getElementsByClassName('configCol')[0].offsetWidth

var sidebarVisible = true;
sidebarToggleButton.innerText = sidebarVisible ? '>' : '<';

function calculateCanvasWidth() {
  if (sidebarVisible)
    return window.innerWidth - sidebarWidth - 36
  else
    return window.innerWidth - 36;
}

var canvasWidth = calculateCanvasWidth();
var isDiffgraph = false;
var normalizeDiff = true, b_scale_factor;
var reverseGraph = false;
var idToFrame = ["clojure.main.main",
"clojure.lang.Var.applyTo",
"clojure.lang.RestFn.applyTo",
"clojure.main/main",
"clojure.main/null-opt",
"clojure.main/initialize",
"clojure.main/init-opt",
"clojure.main/load-script",
"clojure.lang.Compiler.loadFile",
"clojure.lang.Compiler.load",
"clojure.lang.Compiler.eval",
"user$eval27293.invoke",
"user$eval27293.invokeStatic",
"clojure.lang.Var.invoke",
"clojure.lang.RestFn.invoke",
"kaocha.runner/-main",
"clojure.core/apply",
"kaocha.runner/-main*",
"kaocha.runner/run",
"clojure.core/with-bindings*",
"clojure.lang.AFn.applyTo",
"clojure.lang.AFn.applyToHelper",
"kaocha.runner/run/fn--31132",
"kaocha.api/run",
"kaocha.api/run/fn--31069",
"kaocha.api/run/fn--31069/fn--31073",
"clojure.core/with-redefs-fn",
"kaocha.api/run/fn--31069/fn--31073/fn--31074",
"kaocha.testable/run-testables",
"kaocha.testable/run-testable",
"kaocha.testable/run",
"kaocha.plugin.capture-output/capture-output-wrap-run-hook/fn--30590",
"kaocha.plugin.capture-output/capture-output-wrap-run-hook/fn--30590/fn--30591",
"clojure.lang.MultiFn.invoke",
"kaocha.type.clojure.test/eval32065/fn--32066",
"kaocha.test-suite/run",
"kaocha.type.ns/eval31492/fn--31493",
"kaocha.type.ns/run-tests",
"clojure.test/default-fixture",
"kaocha.type.ns/run-tests/fn--31474",
"clojure.core/swap!",
"clojure.lang.Atom.swap",
"kaocha.type.var/eval39377/fn--39379",
"kaocha.type.var/eval39377/fn--39379/fn--39384",
"kaocha.plugin.capture-output/capture-output-pre-test-hook/fn--30598/fn--30599",
"piotr-yuxuan.welcome-base-api.tick-test/fn--39264",
"piotr-yuxuan.welcome-base-api.tick-test/fn--39264/fn--39325",
"piotr-yuxuan.welcome-base-api.tick-test/fn--39264/fn--39325/fn--39329",
"java.math.BigDecimal.divideSmallFastPath",
"piotr-yuxuan.welcome-base-api.tick-test/fn--39264/thunk--39323",
"clojure.lang.Var.getRawRoot",
"piotr-yuxuan.welcome-base-api.tick/size",
"clojure.lang.RT.intCast",
"java.lang.Integer.intValue",
"java.math.BigDecimal.<init>",
"java.math.BigDecimal.divide",
"java.math.BigDecimal.checkScaleNonZero",
"java.math.BigDecimal.doRound",
"java.math.BigDecimal.precision",
"java.math.BigDecimal.longCompareMagnitude",
"java.math.BigDecimal.roundedTenPower",
"java.math.BigDecimal.valueOf",
"java.math.BigDecimal.longDigitLength",
"java.math.BigDecimal.signum",
"java.lang.Long.signum",
"err_codes_libkern_kext",
"supported",
"thread_native_entry(Thread*)",
"Thread::call_run()",
"ConcurrentGCThread::run()",
"G1ServiceThread::run_service()",
"G1ServiceThread::sleep_before_next_cycle()",
"Monitor::wait_without_safepoint_check(long long)",
"os::PlatformMonitor::wait(long)",
"__psynch_cvwait",
"JavaThread::thread_main_inner()",
"CompileBroker::compiler_thread_loop()",
"CompileBroker::invoke_compiler_on_method(CompileTask*)",
"JVMCIRuntime::compile_method(JVMCIEnv*, JVMCICompiler*, methodHandle const&, int)",
"JVMCIEnv::call_HotSpotJVMCIRuntime_compileMethod(JVMCIObject, JVMCIObject, int, long, int)",
"JNIEnv_::CallNonvirtualObjectMethod(_jobject*, _jclass*, _jmethodID*, ...)",
"JNIJavaCallWrappers_jniInvoke_VA_LIST_Nonvirtual_HotSpotJVMCIRuntime_compileMethod_d0551eb00a95b4c222b2a67a9746353d2d54cfa9_9777f9dc163dec00804c9517af22aed879be96a0",
"HotSpotJVMCIRuntime_compileMethod_d0551eb00a95b4c222b2a67a9746353d2d54cfa9",
"HotSpotGraalCompiler_compileMethod_e38c89e51c012e7f227ec5003d2752b35b2d1d20",
"HotSpotGraalCompiler_compileMethod_50d3ecc300d7afc2461a39f7c78f423a8314cf9b",
"HotSpotGraalCompiler_compileMethod_5647c5b255b375f8765f87fdde1408357348e632",
"CompilationTask_runCompilation_90c8888471d47c5d371416635056aa3c9c3a2238",
"CompilationWrapper_run_230b998b01f7b6f8aa59ffa779a359674753600b",
"CompilationTask$HotSpotCompilationWrapper_performCompilation_33ff9935997e9b7516e735b1da6765438369c08a",
"CompilationTask$HotSpotCompilationWrapper_performCompilation_dcd7de759f794bba47a846b2715bb72b7302d616",
"CompilationTask_installMethod_696f7abdb9e00f99fb658590a139165443e027ad",
"Backend_createInstalledCode_9e07b98336b1e9134ddbd1b9f364731ab90ec1de",
"HotSpotCodeCacheProvider_installCode_3a03b5597e27316aa2c6fde9024f8af0e460e84c",
"CompilerToVM_installCode_ff402159e6f168ca78389c3ae681697d50d4abbd",
"c2v_installCode(JNIEnv_*, _jobject*, _jobject*, _jobject*, _jobject*, long, _jbyteArray*)",
"CodeInstaller::install(JVMCICompiler*, JVMCIObject, JVMCIObject, CodeBlob*&, nmethodLocker&, JVMCIObject, FailedSpeculation**, char*, int, JVMCIEnv*)",
"CodeInstaller::initialize_buffer(CodeBuffer&, bool, JVMCIEnv*)",
"JNIJVMCI::site_Infopoint::get_reason(JVMCIEnv*, JVMCIObject)",
"JNIFunctions_GetObjectField_b896a889ade18324cbc5d5d90b52cdc5d4886f72",
"JVMCIEnv::copy_bytes_to(JVMCIPrimitiveArray, signed char*, int, int)",
"HotSpotGraalCompiler_compile_07a2b83c7a0ac1a7ecf68380022f37bb2a8e555d",
"HotSpotGraalCompiler_compileHelper_d3a966217707633929a5b5a4a7670fbd583caf11",
"GraalCompiler_compileGraph_7c727cf4f7ff3555660a81773d74fd53c28861a9",
"GraalCompiler_compile_5fc27c66103532b8aadfba9a53a0cfc56727e415",
"GraalCompiler_emitFrontEnd_dd11dd9655984367d3f025d8b405bcbf578143da",
"BasePhase_apply_713211387b7de6171c1a19a72e42a60bacd2d824",
"PhaseSuite_run_ecb0057d494f6b78d114803459b0549dac0f590e",
"CanonicalizerPhase_run_9f8a39f2353a4c3a71749a4f800c6ebaf3a0da3a",
"CanonicalizerPhase_run_49530004b904addfaa6539c4183571d4fafafef7",
"CanonicalizerPhase$Instance_run_671f7df7cc98f6651d492d7e4e232a17c63a02bc",
"CanonicalizerPhase$Instance_processWorkSet_a3dad50853800e6a49d03763ce1b26bcbbc89703",
"CanonicalizerPhase$Instance_processNode_36be520dc7d8525bad5b7fa18031580ee6572b3a",
"CanonicalizerPhase$Instance_tryGlobalValueNumbering_b31cc300fb8f8c799032bad76096d8c6c8ab7cbb",
"Graph_findDuplicate_04f71970242e686a607aac1650d1b35f629fdc96",
"NodeClass_dataEquals_2465a60c8eae437ee20c480e4464f4b3e6e9ccd5",
"DeoptimizationGroupingPhase_run_3a12572e7733c19fa5afd5bb554ea29fc7da9035",
"DeoptimizationGroupingPhase_run_606851a5b470824677576a2782ab80fcb2e29fd6",
"DeoptimizeNode_getSpeculation_f327d514a4b2875aed7dc689ee7da8c1d342008a",
"ConstantNode_forConstant_bbac664a29b0d3fbd5c1bc60c805d8e6ed3d1c40",
"ConstantNode_createPrimitive_1fd39b660808a2896383e319c58316035c05830e",
"StampFactory_forConstant_57894b43921f292e629bc520a171e7df30e8ca4e",
"FixReadsPhase_run_eadcbaa265fddfc43cd68e424a7d492689320d0e",
"FixReadsPhase_run_3b4a400071b68d362c5469b06e8f723e89497bb6",
"SchedulePhase_run_7d57cb44b92cc72b058895e9b71cab0eef3f80d3",
"SchedulePhase_run_cc03e14c4e377b2874b47ab4f9853a3ab5a30902",
"SchedulePhase$Instance_run_1828bfd7a56bcfe6d09a4adeece509e6120bcf01",
"ControlFlowGraph_compute_a63f8758400e4e42c752fc4a6b7c4bc799df548d",
"ControlFlowGraph_identifyBlocks_91c6bd2376323c10cda627f1ed5130f90d88a82f",
"ReversePostOrder_identifyBlocks_a434e645de3262a8ef97f814aa62be0f987ec6c6",
"ReversePostOrder_assignPredecessorsAndSuccessors_8bc2e1e39349e220a0e7bc9e817dbd591de88cf2",
"ControlFlowGraph_visitDominatorTree_8aab9a0a396d95a81738e2b1caafae8346fa772f",
"ControlFlowGraph_visitDominatorTreeDefault_c5d62c152c81317cdd7fc9a072faf9ed426408e4",
"FixReadsPhase$RawConditionalEliminationVisitor_enter_18d0f6460cacfba1d89f7764d49ea5063bc61a3d",
"FixReadsPhase$RawConditionalEliminationVisitor_enter_6228bc23d1c3df103e52b3d110103fe0237c6419",
"FixReadsPhase$RawConditionalEliminationVisitor_processNode_852b1430a748e21038579eb64d872ec32f0f3a7c",
"FixReadsPhase$RawConditionalEliminationVisitor_processEnd_18bff508ae22e1e0e7fbf72bcdc82200a7dbcdc4",
"EconomicMapImpl_put_1942aede0a18600a103fb4fb4c713214040b54fc",
"IncrementalCanonicalizerPhase_run_ad05c0d3d9f4206c8f044d1b5271f450958cd2d2",
"IncrementalCanonicalizerPhase_run_2f32f23b4745c1b5e791fbafc373edf7b03da19f",
"ConvertDeoptimizeToGuardPhase_run_b3fac1d0c42c9f90bf2140b43e661fa10b97bc82",
"ConvertDeoptimizeToGuardPhase_run_b8541b1eaee8ff6660184571f8219f2a10db57ed",
"ConvertDeoptimizeToGuardPhase_propagateFixed_b2e0739f0f9a2d66ecd699dae494ec686e4fe1ff",
"ConvertDeoptimizeToGuardPhase_isCountedLoopExit_30241f00b83da77e39f160114414e9c45783e4ee",
"LazyValue_get_db2a69bca024add68ba274bc0dceb2d03112afad",
"ConvertDeoptimizeToGuardPhase_lambda$run$0_23869da3f428675ed21b8e7630801d56765d28c7",
"LoopsData_constructor_5fe9234062ec1c8a9f7386919c4076f20437d95a",
"ControlFlowGraph_computeLoopInformation_526dca21915d771b8a7a2bf7ef87535e668bd49b",
"ArrayList_sort_ab199c05e5c13c3e6dc16bca97a561e54f391530",
"Arrays_sort_df8086aea42e7e6975bba0f93bf346a8f80dd38c",
"TimSort_sort_0aa80477f1aac54f67cce516a8a48b311e8921f6",
"SpeculativeGuardMovementPhase_run_9e5715c21ea5200927f0578066114f02eea5f6d8",
"SpeculativeGuardMovementPhase_run_4838edd087db8f245607a626f9e16c50ebcfd00d",
"SpeculativeGuardMovementPhase_performSpeculativeGuardMovement_080c680f16e560ee072a4aaa03f3ed435e7de7e1",
"SpeculativeGuardMovementPhase$SpeculativeGuardMovement_run_11f924f9df10b78a05243e29d4fcdfc74bb78dbf",
"SpeculativeGuardMovementPhase$SpeculativeGuardMovement_earliestBlock_309766b18b48c191a21d86458d8a177fca4da0be",
"SpeculativeGuardMovementPhase$SpeculativeGuardMovement_tryOptimizeCompare_e5d984011d1a3c006097637987aa3ec1cb598816",
"SpeculativeGuardMovementPhase$SpeculativeGuardMovement_tryOptimizeCompare_6881fb4193bec8fada5533047176211e36599820",
"SpeculativeGuardMovementPhase$SpeculativeGuardMovement_optimizeCompare_71ca34da5f9bb4fe80e116d62ec93ec9b1728331",
"SpeculativeGuardMovementPhase$SpeculativeGuardMovement_createLoopEnterCheck_629f1946c68e460f419dc2b22583b266f072800e",
"Graph_addOrUniqueWithInputs_e9b3be51c8ba6fdb8df285e0ca97d0d074b4c70c",
"NodeClass_applyEdges_5358b80572f185992e16b9947a99b634117b2a2d",
"Graph$AddInputsFilter_apply_e34b5d26790f1bead44d13074f1d2a4e10cb6e61",
"Graph_uniqueHelper_2f6997c5abe734058281e99fb69d21d51b150814",
"Node_initialize_3003730a5a3f4c25f00e57bd45f5ddf4cfb46d8a",
"Graph_register_ce602ff6019af0017cf6f2814ac7c980ff37377c",
"Graph$NodeEventListener_event_1d174f9e2d6fe725952d45785d9a6a380b338dff",
"EconomicSetNodeEventListener_changed_4d59c4acf503d3e31e7b2c37c9332bed383d6bb4",
"InliningPhase_run_e6db7cf874d53dc91507291a473f2cc62c2efa89",
"InliningPhase_run_f4ac30eb44649be83d004d685c2edc25e6a1e527",
"InliningData_moveForward_61b4cb014bb6c223e91d6c82648c7ae0d3193161",
"InliningData_processNextInvoke_6aa31ad3e23598b978847c6e7c2bbaba909d7f9b",
"AbstractInlineInfo_populateInlinableElements_43806c6e97853f5f355637b414bfe781a7fd84e8",
"InlineableGraph_constructor_b5537eaf225fa4b063dc96af1deaf01d8c0d9748",
"InlineableGraph_parseBytecodes_383b5dfbc6910e3bb629be5ff5544e78fdfe1197",
"GraphBuilderPhase_run_1c83dae160130ef9ac143eabf153b264c6c02f51",
"GraphBuilderPhase_run_06859817cc94f593c35119fed21a590e64b36a8d",
"GraphBuilderPhase$Instance_run_b2b36039ca684123c1ec14e6804d1c7a4e65a75c",
"BytecodeParser_buildRootMethod_cf5d228f95e1aef84e07bec7df2926f9c73b6177",
"BytecodeParser_build_3618b1a686d7b02d5c64bdd545c0ad56bf942aa6",
"BytecodeParser_processBlock_ec0d67fae85e7a66a62d230bfdd000f577f0cbd6",
"BytecodeParser_handleBytecodeBlock_648f3355709d7ddbd463b7258df7d4d230f70e2d",
"BytecodeParser_iterateBytecodesForBlock_42b1962e6fa2cb90547e67954471496e50b7ca4d",
"BytecodeParser_processBytecode_ab899ffb386ab74cd292aa1e720b59177c3c4dd1",
"BytecodeParser_genInvokeStatic_03212304b6ab417def96c7f989caf853bcb68222",
"BytecodeParser_lookupMethod_21f18fffb58d7acf3e39413e7f019236aff9f41d",
"HotSpotConstantPool_lookupMethod_6ac0fc15ea6a644bb1d87abe092fc00feef7922a",
"CompilerToVM_lookupMethodInPool_6556cf41088eda50b30a1978daa4806a0d0060e4",
"c2v_lookupMethodInPool(JNIEnv_*, _jobject*, _jobject*, int, signed char)",
"JVMCIEnv::get_jvmci_method(methodHandle const&, JVMCIEnv*)",
"JNIEnv_::CallStaticObjectMethod(_jclass*, _jmethodID*, ...)",
"JNIJavaCallWrappers_jniInvoke_VA_LIST_HotSpotResolvedJavaMethodImpl_fromMetaspace_bc85ad54c670528532a2fb7c10dd3feff296ffc1_fae700f323f58679513be84db90421bf188618df",
"HotSpotResolvedJavaMethodImpl_getHolder_b35f9e58398949b35e5d6e15f9a6d53e97bdbfa1",
"DebugContext_logAndIndent_de7560502c38452f26d3e3fefecb4cb64530f01e",
"BytecodeParser_constructor_cf44f47802225680ea5dae989b5956ccaeee0b6f",
"ResolvedJavaMethodBytecode_getProfilingInfo_f084390989169502ab59460715d24680f42e09f1",
"HotSpotResolvedJavaMethodImpl_getProfilingInfo_0d7fe9d7a3a16e21d1416ceecee5f760a8488f5f",
"HotSpotProfilingInfo_constructor_9e9e5f14be70e8a16dd25c0091d1abd7e11d53e9",
"HotSpotMethodData_isProfileMature_7b26f2eedc1cde7bc6c6964d1a512b06b6eefd84",
"CompilerToVM_isMature_5de58549b7c89d7db11275c1d56f7468c519d441",
"c2v_isMature(JNIEnv_*, _jobject*, long)",
"CompilationPolicy::is_mature(Method*)",
"bool CompilerOracle::has_option_value<double>(methodHandle const&, CompileCommand, double&)",
"InliningData_tryToInline_e6af6cc14bbe09ddb942e07f23c9768c79a74a34",
"InliningData_doInline_a060b07a2dc4712bb45063e78567895e4f3a8b1d",
"EconomicSet_addAll_49d51b5bf63c195dfb369371c363b49a593f5951",
"EconomicSet_addAll_0e676f1e8cd65551a50b2c9cb7d2350a41471157",
"EconomicMapImpl_putHashEntry_1ea78e2c71d95d0cd90ff4c443bc1f42479b43fc",
"LoopPartialUnrollPhase_run_d88a47356b73f97c5630c60cd566d306ec2d526b",
"LoopPartialUnrollPhase_run_223018d196f2e79ce2cc4871b32231bd75803b54",
"LoopPartialUnrollPhase_unroll_8b5b7205f316da39f4787031c798aeaa6d08e2be",
"CanonicalizerPhase_applyIncremental_8daa783c42f19396e3e17c3f3e3f7e1fb72e7ac5",
"Phase_run_7939eccd2fbb28f22cd01b77a39d0f3f725002da",
"CanonicalizerPhase$Instance_tryCanonicalize_52a8ad48d36c3a2a686dd669a6757fd3d30f36a3",
"LoopBeginNode_simplify_c07fcbb070046375cd402cb992aab86982f5200b",
"LoopBeginNode_canonicalizePhis_ec1896d4323235684d5659b0b2cbaabf64cc3022",
"LoopTransformations_partialUnroll_bafb025a94d972017ac7e0971fa49e044df103aa",
"LoopFragmentInside_insertWithinAfter_ac9f2335ff0e294e2dd89c342dab01e93ec19789",
"LoopFragment_patchNodes_080cdce4dc1a2bc20184d249bbdc59e0a64127e1",
"Graph_addDuplicates_07179be62d4c8bb8ff0d927f4adba34ae2f3bcdc",
"NodeClass_addGraphDuplicate_6e5d95df78cf047faf66a1157ecde278c56dc2c9",
"NodeClass_createNodeDuplicates_be6a4dc5e6228e21190158fff8e77caa6a6fa46d",
"Node_clone_13ad519958e7583fcbe493e642219e3d9e770776",
"Fields_copy_0841883535fd77e0a710bff986a84df6ec874494",
"LoopSafepointEliminationPhase_run_fbb4d6f7e820a802ae03cb3d26050fe0c59c3c06",
"LoopSafepointEliminationPhase_run_51bfc5495c8170226d31149924c242fa7d975db0",
"LoopsData_detectedCountedLoops_4fcc3ac65eab370a61d436e16eba8fd3dee4c641",
"LoopEx_detectCounted_7359864d97e4ba185bdf591df7aedab6ed100593",
"LoopEx_isOutsideLoop_34df326b74401c232f3e26404c73f343a47e7c86",
"LoopFragment_contains_061d05ec2fdd39eeb24f14b987c6a7ec423a8048",
"LoopFragmentWhole_nodes_23c9a35d03b938811003a20188b5fc619dbf3631",
"LoopFragment_computeNodes_db7adf416dcb7ea05e793581d83fd713ae431c22",
"LoopFragment$2$1_next_32b99ade561daefebc1ca83a477d306514a2fd16",
"LoopFragment$2$1_next_aa3f25bd3cb34a20c1691fb72502302d51fed0a2",
"LoweringPhase_run_13d1db40666a477f7cbe60102a36612201590fd4",
"LoweringPhase_run_244b35790703fa1f3a01ef579ce066e7ceaf1048",
"LoweringPhase_lower_9ffde41562053814346fa9ca2c05d95d6f24d4ad",
"LoweringPhase$Round_run_1d304b777646f831133e25ca12e81b7e07fe0e9d",
"SchedulePhase$Instance_sortNodesLatestWithinBlock_bd62477540a4a50f87b81128b8656bbee982076f",
"LoweringPhase_processBlock_b3e3f26ad1a2eb8a25e497438103eae21502d06e",
"LoweringPhase$Round_process_e148c9f0eaa142bae4181cbf02ddcb3a146b7569",
"Lowerable_lower_cca2f110e49bb9aa41bdb1c4342b12dd2b653cfc",
"AMD64HotSpotLoweringProvider_lower_0b535d03d00f0435dd471fd4f26b80d41c89f6e6",
"DefaultHotSpotLoweringProvider_lower_b8d7af9b6679b425acc0aeb2099026a58ea661b4",
"DefaultHotSpotLoweringProvider_lowerWithoutDelegation_f3a347975f45a50cc08449f5303ac51cabc38021",
"HotSpotAllocationSnippets$Templates_lower_9fa7d850a63ac16fcc2b74bb33e04e8dddc7dbdb",
"SnippetTemplate$AbstractTemplates_template_6646c34d0b22fea9e70e6070b215f697ee5d7d47",
"SnippetTemplate_constructor_9a83c8413dd4f4f3ef242978687c90c10f9a28b1",
"FloatingReadPhase_run_7fa617d2974fa75bb1ccab1c029e76206080060e",
"ReentrantNodeIterator_apply_59b036dc10d185170659291c94b08d1004fc3ed8",
"FloatingReadPhase$FloatingReadClosure_merge_2f1f130b2b7cd7bb59df08a3a167489d897ad8d1",
"FloatingReadPhase_mergeMemoryMaps_e0855fa0353bdf3093627f46e117e5c971751c38",
"ArrayList$Itr_next_bc70a890e1dcc46e3198eb86d01fef9762d1343b",
"ArrayList$Itr_checkForComodification_bae1221fb3794991dfedf1d6e9c5e26ec24b27c6",
"SnippetTemplate_explodeLoops_0aaee50e3807baad7c1da16a9cc58f6cc3419089",
"LoopTransformations_fullUnroll_48134db102a930a88f18d7b2c28f2a2b467df8fe",
"CanonicalizerPhase$Instance_tryInferStamp_87ff4ee2c031392e7e622f751b582d1e591c60dd",
"CounterKeyImpl_add_4f82947d2dee8d75ec2888570d43f18eb0e9ddd8",
"IfNode_simplify_9e26888f05769de31d900e952feb6d957443af34",
"GraphUtil$DefaultSimplifierTool_deleteBranch_68196ecbd6519600d7628b43a8f0139c2e37bde3",
"GraphUtil_killCFG_e3cc7ecb54bb89f0323b9492d2bb031a75aa3db8",
"GraphUtil_killCFGInner_1224cafb5c48816888fac996fc0748e639073650",
"GraphUtil_markFixedNodes_57d24f66d49584846951845a2e13f884c0e20d53",
"ArrayList_add_43f6399c3b46d50c69e7ebaee5e44ba3b6a870f3",
"ArrayList_add_1f41ac6612d40654ece03773af4ead4bc05b3fb8",
"HotSpotAllocationSnippets$Templates_lower_d7d3727607d8e2dd12771a5b705c4ed6442e57eb",
"LoopTransformations_peel_ca3eec7a9321cb93cc530ea3f0b55e8a426ec85b",
"LoopFragmentInside_insertBefore_0ede2679249b18372d85e0f0a3856b196dcceebf",
"LoopFragmentInside_patchPeeling_a3593f9a21bdeac25bdb6a41b1f9d0d85c9ab1ff",
"NodeIterable_count_dc00660ccb5cb66fec7dd5c2992fae11d7d98d12",
"NodeIterator_hasNext_3034c3cb673c340f10e1ac52303cca4d668c2cc0",
"PredicatedProxyNodeIterator_forward_ecd79197b179fb5fc8b47203a1fa126599252c97",
"NodePredicates$PositiveTypePredicate_apply_53bcc431374faa566af2da0c75e1b00ddd5a6f85",
"InstanceOfSnippetsTemplates_lower_e7dc56145cc61db2e0f27762e41162aa80226315",
"GraphUtil_killWithUnusedFloatingInputs_5f12205c43ccdcee3608e0db27fe62e0a393b949",
"OnStackReplacementPhase_run_ed1bee556438321a17b5beb0110d138008567c70",
"OnStackReplacementPhase_run_f031ff6606df081eb93d0d182f98da50eeb0470b",
"NodeClass_transferEdgesDifferentNodeClass_410a8aabb2e6016f7a61015bb3cb7275c609ff51",
"NodeClass_transferEdges_5c4a88d2fe68c19dbb8d0e271a3e973aa2a39d0f",
"Position_set_b6a68b2510a09f2cf2b431e0a714c03e30fc1256",
"Edges_setNode_27873ec4ba27f1d7139d9109e270b9879424c92c",
"Node_updatePredecessor_453b327af719f718fb0c0a253b39b752c6928c1f",
"ControlFlowGraph_identifyBlock_7f27028f31036b771721050156eba6ce33899dfa",
"NodeMap_set_c00c8d358fedf9f1c4da34997b1824d655070096",
"PartialEscapePhase_run_f88ed79b0084aa41ee5a5292ba857ec43e7be3a5",
"PartialEscapePhase_run_3df35e22289fd9cb0ee4d02d404c2d4f13b2d727",
"EffectsPhase_runAnalysis_54f9478d1b57872ffb93f7e08dfb56cfeaaba51c",
"LIRCompilerBackend_emitBackEnd_021a7e30d2cf9c7e175e805b12576b2faa968161",
"LIRCompilerBackend_emitLIR_71233f19aaaaeb8e4cb4993ed4c9e959063fbd71",
"LIRCompilerBackend_emitLIR0_1217baa260206070dfc8739e40eb2ee2ded71476",
"LIRCompilerBackend_emitLowLevel_4fe585e14b242597df0ab8ae485f3416fddc991d",
"LIRPhase_apply_f88294980b4069af9bbdf7490a29e7232cbb1793",
"LIRPhaseSuite_run_8261160fad1049c08835cb0ad391fe506cf85f32",
"ConstantLoadOptimization_run_935b4bc38712c20a369af4931585e78798738f70",
"ConstantLoadOptimization_run_28eb05ae4e4117bfeb6354b00463d70d6bd8f382",
"ConstantLoadOptimization$Optimization_constructor_df0bb7b356b3c46ee50d9904fc01c4c82e7541ac",
"LSStackSlotAllocator_run_46f0d6d05698703ea78c48301673aefc32a83b76",
"LSStackSlotAllocator_run_8731cbd7414b044238d60f6a424d76164f892d9a",
"LSStackSlotAllocator_allocateStackSlots_24708dec186d6148572db487df48d1fe33796e42",
"LSStackSlotAllocator$Allocator_allocate_8c68eb39cd06cb5f0798f69b101e8144f0953355",
"LSStackSlotAllocator$Allocator_buildIntervals_55cfd7fe557a5a3fa77deaa4a027104ce5fdf027",
"FixPointIntervalBuilder_build_ceb28e2ddd9ed1dbfe2a496adff9070454612a63",
"FixPointIntervalBuilder_processBlock_224b061976bad6a9efdc5fccd8bc53f8df6a44f2",
"FixPointIntervalBuilder$BlockClosure_processInstructionBottomUp_af3aa370c29b5d04d56ed9325fad5ca6270caebe",
"LIRInstructionClass_visitEachState_d96371334b901ac980132b4275f31c1eba9fc971",
"LIRFrameState_visitEachState_745c9f11cceb6019913bb94ebdf3f6061900032d",
"LIRFrameState_visitValues_39992acd60cdd755a91b759ee618c9f7e1d1e7e4",
"FixPointIntervalBuilder$BlockClosure$1_visitValue_ed563e3a932f2a8a2997b3a9cc0a3f96e90de1ea",
"LinearScanPhase_run_79455c1f7ffc284d11c8b4cb98025d89c480845f",
"LinearScanPhase_run_c8919ef88d01a6b33119dbe97a072c67e193e833",
"LinearScan_allocate_658ed41c42a38ac0b2130d41b18044d59fd18304",
"LinearScanAllocationPhase_apply_32ce9f2f5be753814b6f81202a57be6203e1a904",
"LinearScanLifetimeAnalysisPhase_run_ab4cb4dbd758d5d3c0e354e191b311860fe58b52",
"LinearScanLifetimeAnalysisPhase_buildIntervals_0cb08519c3ed66232ec4bd817bfad2d3b8a98bd7",
"LIRIntrospection_visitEach_28a8f0d7040ecdb3aeceb75e6eb9d4b16f2fc5bb",
"LinearScanLifetimeAnalysisPhase$$Lambda$f5a65141a702435ff6cb059857c70dede191455c_visitValue_8cf56b6dffc4430646be261f16194b2963c72b05",
"LinearScanLifetimeAnalysisPhase_lambda$buildIntervals$6_86f2c8b0ccdf6720cac0a64c0e007cf1a0c12655",
"LinearScanLifetimeAnalysisPhase_addDef_4fb59b96f5e55df7f9ae644333e0a6dd273ce564",
"LinearScan_getOrCreateInterval_1463cc2123b7d4e77092e784e44442d48ee408cb",
"LinearScan_intervalFor_3e677a1f46acac9d2326ff3962b6ddb67b5e5db5",
"LinearScanLifetimeAnalysisPhase_computeLocalLiveSets_89a47054859320476a21af958adc17dcc239ecd5",
"RedundantMoveElimination_run_e6599a508810bb546bdd83a918228ee0569f4443",
"RedundantMoveElimination_run_8e5a069070bbf7278af28439c381ee358062dc15",
"RedundantMoveElimination$Optimization_doOptimize_1378ad605ce8e7305ced13374b32214764590c27",
"RedundantMoveElimination$Optimization_initBlockData_640e78dc6c5947b7a4876ad67c158af2283bb66b",
"LIRGenerationPhase_run_1168e036e71ef03e6dc18353b13e37ba25b2a72e",
"LIRGenerationPhase_run_34d05efdd4b829f90fa75600fde34611b9de1909",
"LIRGenerationPhase_emitBlock_b1af2b6ad6d34d4c506cd38df7e1e3f393cfd111",
"NodeLIRBuilder_doBlock_8c06e34b0350e6248550dc28993743b7a85b75fa",
"NodeLIRBuilder_doRoot_893017f47f5cdc4e711039b8f127be550e81d644",
"NodeLIRBuilder_emitNode_f3d545ee582c3dc3292bbf4e9505280ca370ad52",
"AbstractEndNode_generate_b5fdb01385bcef83b072d4af6340887e43ffe59f",
"NodeLIRBuilder_visitEndNode_58d850ea4119def659f7f357826105bdc600662e",
"NodeLIRBuilder_createPhiOut_702fa20e419faa10877a6a29d308a5fbed4023fe",
"ThreadLocalAllocation_slowPathNewInstance_39ae850940ab632d109995344de15fd9d3b31d84",
"ThreadLocalAllocation_slowPathNewInstanceWithoutAllocating_c1e47c63f179ee3cf26bd8b9e5c51627b678a880",
"GCImpl_maybeCollectOnAllocation_2f1035515c6a41b10122086ba472b562d017fbcf",
"GCImpl_collectWithoutAllocating_7b5a2f4b33834a1092beae4b5758ad4f755a6f25",
"NativeVMOperation_enqueue_049b944802b20d390256d99e8e68888be24b8a3b",
"VMOperationControl_enqueue_03e7b9db64ca751377c28fff6e469d5ec4037d0d",
"VMOperationControl$WorkQueues_enqueueAndExecute_ab94e6b59bf62abe2fd68824c94f4e3e89ee1fec",
"VMOperationControl$WorkQueues_executeAllQueuedVMOperations_f857a99d4236077ebd4579d580c21458b5ca3ea1",
"VMOperationControl$WorkQueues_drain_0f0481fc351b0ba4ff533185117d85969237dbbf",
"VMOperation_execute_58740434efda785fa124068a49feed361ad4a2b9",
"GCImpl$CollectionVMOperation_operate_66fd1b21148832fcbb89249bb3bb3d2b830eaf79",
"GCImpl_collectOperation_ed357ac3395b351b396449f161fbdf4e10072716",
"GCImpl_collectImpl_af095920dbe6b2b45d9952e011246050fab95516",
"GCImpl_doCollectImpl_fbd075fd8f6a582cb98120cb239cf3c0b6b9e194",
"GCImpl_doCollectOnce_b497b60e1b6c478646e130874225bfe62a9553d1",
"GCImpl_scavenge_b7271340e4da983a7681bb635dfa2dfffa6ce7ba",
"GCImpl$ChunkReleaser_release_5483844c0e18c9d7babe2e89de7300bbc2eefb09",
"HeapChunkProvider_consumeAlignedChunks_ccc0af4ac5011150001acbbf87cef17bb519c735",
"HeapChunkProvider_freeAlignedChunkList_f86d489dc2169b52922a42264bc04ecd5ddd7d14",
"OSCommittedMemoryProvider_free_c2bc7dae826b0ce6c30783fd18ce36ba9ebdae91",
"__munmap",
"GCImpl_cheneyScanFromDirtyRoots_38e2f549830d39bed60fc139ea601adffadffc8a",
"GCImpl_scanGreyObjects_58c2ee47e000462416451fb2afdb5838c25cf045",
"GCImpl_scanGreyObjectsLoop_63c2512b14cdc4d5e20334f93c9e9545c5cc9ad7",
"YoungGeneration_scanGreyObjects_c35d3cb5fa4af6e0a762dc16e96320865b1e2ebb",
"GreyObjectsWalker_walkGreyObjects_e59a80a81022647b793f2f995d251cf18cbcbab4",
"UnmanagedMemoryUtil_copyLongsForward_786a2262c2ed5c6469526ec7d53d0364ced07432",
"GCImpl_cheneyScanFromRoots_02fdc07687b04990522d42191c41890e9ae45333",
"OldGeneration_scanGreyObjects_a53581b0f8a68acd00124c8934ac4a137d22771f",
"MonitorDeflationThread::monitor_deflation_thread_entry(JavaThread*, JavaThread*)",
"attach_listener_thread_entry(JavaThread*, JavaThread*)",
"close",
"load_agent(AttachOperation*, outputStream*)",
"JvmtiExport::load_agent_library(char const*, char const*, char const*, outputStream*)",
"os::dll_load(char const*, char*, int)",
"[unknown]",
"WatcherThread::run()",
"WatcherThread::sleep() const",
];
var reverse = false;
var initialStacks = [];
var stacks;

var _lastInsertedStack = null;

function a(frameIds, samples) {
  var same = frameIds[0];
  var frames = (same > 0) ? _lastInsertedStack.slice(0,same) : [];

  for (var i = 1, len = frameIds.length; i < len; i++) {
    frames.push(idToFrame[frameIds[i]]);
  }

  _lastInsertedStack = frames;
  initialStacks.push({stackStr: frames.join(";"), samples: samples});
}

var totalSamplesA = 0, totalSamplesB = 0;

function d(frameIds, samples_a, samples_b) {
  var same = frameIds[0];
  var frames = (same > 0) ? _lastInsertedStack.slice(0,same) : [];

  for (var i = 1, len = frameIds.length; i < len; i++) {
    frames.push(idToFrame[frameIds[i]]);
  }

  totalSamplesA += samples_a;
  totalSamplesB += samples_b;

  _lastInsertedStack = frames;
  initialStacks.push({stackStr: frames.join(";"),
                      samples_a: samples_a, samples_b: samples_b});
}

function _extractRegexPrefix(s) {
  let parsed = s.match(/^\/\.\+(.+)\/g$/);
  if (parsed != null) {
    return new RegExp(parsed[1]);
  }
}

function _stringToMaybeRegex(s) {
  if (s == null) return null;
  let parsed = s.match(/^\/(.+)\/$/);
  if (parsed != null)
    return new RegExp(parsed[1], 'g');
  else
    return s;
}

function _makeTransform(type, enabled, what, replacement) {
  let what2 = (typeof(what) == 'string') ? _stringToMaybeRegex(what) : what;
  let prefix = (what2 instanceof RegExp) ?
      _extractRegexPrefix(what2.toString()) : null;
  if (type == 'replace')
    return { type: type, enabled: enabled, what: what2, replacement: replacement, prefix: prefix}
  else
    return { type: type, enabled: enabled, what: what2}
}

var userTransforms = [];

function match(string, obj) {
  if (typeof(obj) == 'string') {
    return string.includes(obj);
  } else
    return string.match(obj);
}

function applyReplacement(string, what, replacement, prefix) {
  var s = string;
  if (prefix != null) {
    let match = prefix.exec(string);
    if (match == null)
      return s;
    else
      s = string.substring(Math.max(match.index-1, 0));
  }
  return s.replaceAll(what, replacement);
}

function transformStacks() {
  console.time("transformStacks");
  let diff = isDiffgraph;
  var result;
  if (userTransforms.length > 0) {
    var xformedMap = {};
    for (var i = 0; i < initialStacks.length; i++) {
      var stack = initialStacks[i];
      var xformedStr = stack.stackStr;
      var useIt = true;

      for (var t = 0; t < userTransforms.length; t++) {
        const transform = userTransforms[t];
        if (transform.enabled && transform.what != '') {
          if (transform.type == 'replace') {
            xformedStr = applyReplacement(xformedStr, transform.what,
                                          transform.replacement, transform.prefix);
          } else if (transform.type == 'filter') {
            if (!match(xformedStr, transform.what))
              useIt = false;
          } else if (transform.type == 'remove') {
            if (match(xformedStr, transform.what))
              useIt = false;
          }
        }
        if (!useIt) break;
      }

      if (useIt)
        if (diff) {
          let newVal = (xformedMap[xformedStr] || {});
          newVal.samples_a = (newVal.samples_a || 0) + stack.samples_a;
          newVal.samples_b = (newVal.samples_b || 0) + stack.samples_b;
          xformedMap[xformedStr] = newVal;
        } else
          xformedMap[xformedStr] = stack.samples + (xformedMap[xformedStr] || 0);
    }

    var xformedStacks = [];
    for (xformedStr in xformedMap) {
      if (diff) {
        let val = xformedMap[xformedStr];
        xformedStacks.push({stackStr: xformedStr, samples_a: val.samples_a, samples_b: val.samples_b})
      } else
        xformedStacks.push({stackStr: xformedStr, samples: xformedMap[xformedStr]});
    }
    result = xformedStacks;
  } else
    result = initialStacks;

  console.timeEnd("transformStacks");
  return result;
}

console.time("data exec time");

  a([0,0,1,2,3,4,5,6,7,8,9,10,10,11,12,13,14,15,16,2,17,18,14,19,16,20,21,22,23,14,19,16,20,21,24,14,19,16,20,21,25,26,27,28,29,30,14,31,26,32,16,20,21,33,34,35,28,29,30,14,31,26,32,16,20,21,33,36,37,38,39,40,41,28,29,30,14,31,26,32,16,20,21,33,42,43,44,45,46,47,],116);
a([89,48,],79);
a([89,49,],34);
a([90,50,],21);
a([90,51,],88);
a([91,52,53,],14);
a([91,54,],1);
a([91,55,],46);
a([92,55,],86);
a([93,48,],135);
a([94,56,],13);
a([94,57,],59);
a([95,58,],21);
a([94,59,],13);
a([94,60,],19);
a([95,61,61,],16);
a([92,58,],9);
a([93,62,],81);
a([92,63,64,],70);
a([0,65,66,67,68,69,70,71,72,73,74,],1);
a([4,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,],1);
a([24,99,],1);
a([19,100,101,102,103,104,105,106,105,107,108,109,110,111,],1);
a([32,112,113,114,],1);
a([27,115,116,117,118,119,120,],1);
a([27,121,122,105,123,124,125,126,127,128,129,],1);
a([29,130,131,132,133,134,135,136,],1);
a([27,137,138,106,105,139,140,141,142,143,144,145,126,146,147,148,149,],1);
a([31,150,151,152,153,154,155,156,157,158,159,160,161,159,162,163,164,165,166,],1);
a([27,167,168,169,170,171,172,173,105,106,105,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,],1);
a([43,192,],1);
a([40,193,194,195,196,197,198,199,200,201,],1);
a([30,202,203,204,205,136,206,],1);
a([27,207,208,209,210,105,211,109,110,111,212,213,214,114,],1);
a([30,215,216,217,218,219,220,221,222,],1);
a([27,223,224,225,226,227,228,229,230,231,232,],1);
a([27,233,234,235,105,137,138,106,105,211,236,105,123,124,237,],1);
a([37,238,239,240,241,242,243,244,245,246,105,137,138,106,105,211,247,248,249,250,251,252,],1);
a([46,253,254,210,105,211,109,110,111,255,256,],1);
a([48,257,258,259,260,261,262,263,],1);
a([43,264,245,246,253,254,265,266,267,268,269,270,271,],1);
a([43,272,273,],1);
a([27,274,275,265,266,217,218,219,276,277,278,279,280,],1);
a([29,145,126,127,281,282,],1);
a([27,283,284,285,105,123,124,125,126,127,],1);
a([23,286,287,288,289,290,291,290,292,293,294,],1);
a([30,295,296,297,298,299,300,301,302,303,304,305,306,136,],1);
a([30,307,308,309,310,311,312,313,314,315,316,317,318,],1);
a([35,319,],1);
a([30,320,321,322,323,],1);
a([26,290,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,],1);
a([52,354,355,356,357,358,],1);
a([57,359,],1);
a([52,360,355,361,358,],2);
a([5,362,72,73,74,],1);
a([5,363,364,],1);
a([6,365,366,367,368,368,368,368,368,368,368,368,368,],1);
a([4,369,370,72,73,74,],5);


console.timeEnd("data exec time");


function makeTreeNode() {
  if (isDiffgraph)
    return {self_samples_a: 0, self_samples_b: 0, self_delta: 0,
            total_samples_a: 0, total_samples_b: 0, total_delta: 0,
            delta_abs: 0, children: {}};
  else
    return {self: 0, total: 0, children: {}};
}

function getChildNode(node, childTitle) {
  var children = node.children;
  var child = children[childTitle];
  if (child == undefined) {
    child = makeTreeNode();
    children[childTitle] = child;
  }
  return child;
}

function parseStacksToTreeSimple(stacks, treeRoot) {
  console.time("parseStacksToTreeSimple");
  var depth = 0;
  for (var i = 0, len = stacks.length; i < len; i++) {
    var stack = stacks[i];
    var stackframes = stack.stackStr.split(";");
    var stackLen = stackframes.length;
    depth = Math.max(depth, stackLen);
    var node = treeRoot;
    if (reverseGraph) {
      for (var j = stackLen-1; j >= 0; j--) {
        var stackframe = stackframes[j];
        node.total += stack.samples;
        node = getChildNode(node, stackframe);
      }
    } else {
      for (var j = 0; j < stackLen; j++) {
        var stackframe = stackframes[j];
        node.total += stack.samples;
        node = getChildNode(node, stackframe);
      }
    }
    node.total += stack.samples;
    node.self += stack.samples;
  }
  console.timeEnd("parseStacksToTreeSimple");
  return depth;
}

function parseStacksToTreeDiffgraph(stacks, treeRoot) {
  console.time("parseStacksToTreeDiffgraph");
  var depth = 0;

  for (var i = 0, len = stacks.length; i < len; i++) {
    var stack = stacks[i];
    var stackframes = stack.stackStr.split(";");
    var stackLen = stackframes.length;
    depth = Math.max(depth, stackLen);
    var node = treeRoot;

    var samplesA = stack.samples_a;
    var samplesB = stack.samples_b;
    if (normalizeDiff) samplesB = Math.round(samplesB * b_scale_factor);
    var delta = samplesB - samplesA;


    if (reverseGraph) {
      for (var j = stackLen-1; j >= 0; j--) {
        var stackframe = stackframes[j];
        node.total_samples_a += samplesA;
        node.total_samples_b += samplesB;
        node.total_delta += delta;
        node.delta_abs += Math.abs(delta);
        node = getChildNode(node, stackframe);
      }
    } else {
      for (var j = 0; j < stackLen; j++) {
        var stackframe = stackframes[j];
        node.total_samples_a += samplesA;
        node.total_samples_b += samplesB;
        node.total_delta += delta;
        node.delta_abs += Math.abs(delta);
        node = getChildNode(node, stackframe);
      }
    }
    node.self_samples_a += samplesA;
    node.self_samples_b += samplesB;
    node.self_delta += delta;
    node.delta_abs += Math.abs(delta);
  }
  console.timeEnd("parseStacksToTreeDiffgraph");
  return depth;
}

function parseStacksToTree(stacks, treeRoot) {
  if (isDiffgraph)
    return parseStacksToTreeDiffgraph(stacks, treeRoot);
  else
    return parseStacksToTreeSimple(stacks, treeRoot);
}

const palette = {
  green: "#50e150",
  aqua: "#50bebe",
  orange: "#e17d00",
  yellow: "#c8c83c",
  red: "#e15a5a",
  clojure_green: "#91dc51",
  clojure_blue: "#8fb5fe",
};

function getColor(title) {
  if (title.endsWith("_[j]")) {
    return palette.green;
  } else if (title.endsWith("_[i]")) {
    return palette.aqua;
  } else if (title.endsWith("_[k]")) {
    return palette.orange;
  } else if (title.includes("::") || title.startsWith("-[") || title.startsWith("+[")) {
    return palette.yellow;
  } else if (title.includes("/")) { // Clojure (will only work after unmunging)
    return palette.clojure_blue;
  } else if (title.includes(".")) { // Java (if it has a dot and is not Clojure)
    return palette.clojure_green;
  } else return palette.red;
}

function decToHex(n) {
  var hex = n.toString(16);
  return hex.length == 1 ? "0" + hex : hex;
}

function getDiffColor(isRed, intensity) {
  return "hsl(" + ((isRed) ? 0 : 220) + ",100%," + Math.round(90 - intensity * 30) + "%)";
  // return "hsl(" + ((isRed) ? 0 : 220) + "," + Math.round(100 * intensity) + "%, 60%)";
}

function scaleColorMap(colorMap, intensity) {
  return '#' + decToHex(intensity * colorMap.red) +
    decToHex(intensity * colorMap.green) + decToHex(intensity * colorMap.blue);
}

var stacks, tree, levels, depth;

var smallestPixelsPerSample, minPixelsPerFrame = 0.25, minSamplesToShow;

function generateLevelsSimple(levels, node, title, level, x, minSamplesToShow) {
  var left = x;

  levels[level] = levels[level] || [];
  if (node.total >= minSamplesToShow) {
    levels[level].push({left: left, width: node.total, color: getColor(title),
                        title: title});

    left += node.self;

    let children = Object.entries(node.children);
    if (sortByNameRadio.checked)
      children.sort((a, b) => a[0].localeCompare(b[0]));
    else
      children.sort((a, b) => b[1].total - a[1].total);

    for (let i in children) {
      let title = children[i][0];
      let child = children[i][1];
      generateLevelsSimple(levels, child, title, level+1, left, minSamplesToShow);
      left += child.total;
    }
  }
}

function generateLevelsDiffgraph(levels, node, title, level, x, minSamplesToShow) {
  var left = x;

  levels[level] = levels[level] || [];
  if (node.delta_abs >= minSamplesToShow) {
    var change = (node.total_samples_a == 0) ? 1.0 : node.total_delta / node.total_samples_a;
    var color = getDiffColor((node.total_delta > 0), Math.min(Math.abs(change), 1.0));
    levels[level].push({left: left, width: node.delta_abs,
                        self_samples_a: node.self_samples_a,
                        self_samples_b: node.self_samples_b,
                        self_delta: node.self_delta,
                        total_samples_a: node.total_samples_a,
                        total_samples_b: node.total_samples_b,
                        total_delta: node.total_delta,
                        color: color,
                        title: title});

    left += Math.abs(node.self_delta);

    let children = Object.entries(node.children);
    if (sortByNameRadio.checked)
      children.sort((a, b) => a[0].localeCompare(b[0]));
    else
      children.sort((a, b) => b[1].delta_abs - a[1].delta_abs);

    for (let i in children) {
      let title = children[i][0];
      let child = children[i][1];
      generateLevelsDiffgraph(levels, child, title, level+1, left, minSamplesToShow);
      left += child.delta_abs;
    }
  }
}

function generateLevels(levels, node, title, level, x, minSamplesToShow) {
  if (isDiffgraph)
    generateLevelsDiffgraph(levels, node, title, level, x, minSamplesToShow);
  else
    generateLevelsSimple(levels, node, title, level, x, minSamplesToShow);
}

function refreshData() {
  if (isDiffgraph && normalizeDiff)
    b_scale_factor = totalSamplesA / totalSamplesB;

  stacks = transformStacks();

  tree = makeTreeNode();

  depth = parseStacksToTree(stacks, tree);
  smallestPixelsPerSample = canvasWidth / (tree.total || tree.delta_abs);
  minSamplesToShow = minPixelsPerFrame / smallestPixelsPerSample;

  levels = [];
  generateLevels(levels, tree, "all", 0, 0, minSamplesToShow);
  depth = levels.length;
}

refreshData();

var canvasHeight;

function initCanvas() {
  canvasHeight = (depth + 1) * 16;
  canvas.style.width = canvasWidth + 'px';
  canvas.width = canvasWidth * (devicePixelRatio || 1);
  canvas.height = canvasHeight * (devicePixelRatio || 1);
  if (devicePixelRatio) c.scale(devicePixelRatio, devicePixelRatio);
  c.font = document.body.style.font;
}

initCanvas();
isNormalizedDiv.style.display = isDiffgraph ? 'inherit' : 'none';

var highlightPattern = null, currentRootFrame, currentRootLevel, px;

function render(newRootFrame, newLevel) {
  console.time("render");
  // Background
  var gradient = c.createLinearGradient(0, 0, 0, canvasHeight);
  gradient.addColorStop(0.05, "#eeeeee");
  gradient.addColorStop(0.95, "#eeeeb0");
  c.fillStyle = gradient;
  c.fillRect(0, 0, canvasWidth, canvasHeight);

  currentRootFrame = newRootFrame || levels[0][0];
  currentRootLevel = newLevel || 0;
  px = canvasWidth / currentRootFrame.width;

  const marked = [];

  function mark(f) {
    return marked[f.left] >= f.width || (marked[f.left] = f.width);
  }

  function totalMarked() {
    let total = 0;
    let left = 0;
    for (let x in marked) {
      if (+x >= left) {
        total += marked[x];
        left = +x + marked[x];
      }
    }
    return total;
  }

  const x0 = currentRootFrame.left;
  const x1 = x0 + currentRootFrame.width;

  function drawFrame(f, y, alpha) {
    if (f.left < x1 && f.left + f.width > x0) {
      c.fillStyle = highlightPattern && f.title.match(highlightPattern) && mark(f) ? '#ee00ee' : f.color;
      c.fillRect((f.left - x0) * px, y, f.width * px, 15);

      if (f.width * px >= 21) {
        const chars = Math.floor(f.width * px / 7);
        const title = f.title.length <= chars ? f.title : f.title.substring(0, chars - 2) + '..';
        c.fillStyle = '#000000';
        c.fillText(title, Math.max(f.left - x0, 0) * px + 3, y + 12, f.width * px - 6);
      }

      if (alpha) {
        c.fillStyle = 'rgba(255, 255, 255, 0.5)';
        c.fillRect((f.left - x0) * px, y, f.width * px, 15);
      }
    }
  }

  for (let h = 0; h < levels.length; h++) {
    const y = reverse ? h * 16 : canvasHeight - (h + 1) * 16;
    const frames = levels[h];
    for (let i = 0; i < frames.length; i++) {
      if (frames[i].width >= minSamplesToShow)
        drawFrame(frames[i], y, h < currentRootLevel);
    }
  }

  if (highlightPattern != null) {
    matchContainer.style.display = 'inherit';
    matchedLabel.textContent = pct(totalMarked(), currentRootFrame.width) + '%';
  } else
    matchContainer.style.display = 'none';
  console.timeEnd("render");
}

render();

function round2dig(n) {
  return Math.round(n * 100) / 100;
}

function ratioToPct(n) {
  return ((n > 0) ? "+" : "") + (n * 100).toFixed(2) + "%";
}

function findFrame(frames, x) {
  let left = 0;
  let right = frames.length - 1;

  while (left <= right) {
    const mid = (left + right) >>> 1;
    const f = frames[mid];

    if (f.left > x) {
      right = mid - 1;
    } else if (f.left + f.width <= x) {
      left = mid + 1;
    } else {
      return f;
    }
  }

  if (frames[left] && (frames[left].left - x) * px < 0.5) return frames[left];
  if (frames[right] && (x - (frames[right].left + frames[right].width)) * px < 0.5) return frames[right];

  return null;
}

canvas.onmousemove = function() {
  const h = Math.floor((reverse ? event.offsetY : (canvasHeight - event.offsetY)) / 16);
  if (h >= 0 && h < levels.length) {
    const f = findFrame(levels[h], event.offsetX / px + currentRootFrame.left);
    if (f && f.width >= minSamplesToShow) {
      hl.style.left = (Math.max(f.left - currentRootFrame.left, 0) * px + canvas.offsetLeft) + 'px';
      hl.style.width = (Math.min(f.width, currentRootFrame.width) * px) + 'px';
      hl.style.top = ((reverse ? h * 16 : canvasHeight - (h + 1) * 16) + canvas.offsetTop) + 'px';
      // hl.firstChild.textContent = f.title;
      hl.style.display = 'block';
      if (isDiffgraph) {
        var rel_change = (f.total_samples_a == 0) ? 1.0 : f.total_delta / f.total_samples_a;
        var total_change = f.total_delta / tree.total_samples_a;
        canvas.title = `${f.title}\n(${samples(f.total_delta, true)}, ${ratioToPct(rel_change)} self, ${ratioToPct(total_change)} total)`;
        // , self_samples_a: ${f.self_samples_a}, self_samples_b: ${f.self_samples_b},  self_delta: ${f.self_delta},  total_samples_a: ${f.total_samples_a},  total_samples_b: ${f.total_samples_b}, total_delta: ${f.total_delta})`;
      } else
        canvas.title = f.title + '\n(' + samples(f.width) + ', ' + pct(f.width, levels[0][0].width) + '%)';
      canvas.style.cursor = 'pointer';
      canvas.onclick = function() {
        if (f != currentRootFrame) {
          render(f, h);
          canvas.onmousemove();
        }
      };
      status.textContent = 'Function: ' + canvas.title;
      return;
    }
  }
  canvas.onmouseout();
}

canvas.onmouseout = function() {
  hl.style.display = 'none';
  status.textContent = '\xa0';
  canvas.title = '';
  canvas.style.cursor = '';
  canvas.onclick = '';
}

function samples(n, add_plus) {
  return (add_plus && n > 0 ? "+" : "") + (n === 1 ? '1 sample' : n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')) + ' samples';
}

function pct(a, b) {
  return a >= b ? '100' : (100 * a / b).toFixed(2);
}

//// Configuration panel

function highlightApply() {
  const pattern = highlightInput.value;
  highlightPattern = (pattern == "") ? null : _stringToMaybeRegex(pattern);
  render(currentRootFrame, currentRootLevel);
}

function highlightClear() {
  highlightPattern = null;
  render(currentRootFrame, currentRootLevel);
}

function userTransformsSwap(idx1, idx2) {
  const swap = userTransforms[idx1];
  userTransforms[idx1] = userTransforms[idx2];
  userTransforms[idx2] = swap;
}

function addNewTransform() {
  syncTransformsModelWithUI();
  let type = newTransformType.value;
  userTransforms.push(_makeTransform(type, true, "", ""));
  redrawTransformsSection();
}

function deleteTransform(originator) {
  syncTransformsModelWithUI();
  userTransforms.splice(originator.internalId, 1);
  redrawTransformsSection();
}

function cloneTransform(originator) {
  syncTransformsModelWithUI();
  const idx = originator.internalId;
  userTransforms.splice(idx+1, 0, Object.assign({}, userTransforms[idx]));
  redrawTransformsSection();
}

function moveTransformUp(originator) {
  const idx = originator.internalId;
  if (idx == 0) return;
  syncTransformsModelWithUI();
  userTransformsSwap(idx-1, idx);
  redrawTransformsSection();
}

function moveTransformDown(originator) {
  const idx = originator.internalId;
  if (idx == userTransforms.length-1) return;
  syncTransformsModelWithUI();
  userTransformsSwap(idx, idx+1);
  redrawTransformsSection();
}

function refreshAfterEnabledToggle() {
  syncTransformsModelWithUI();
  redrawTransformsSection();
}

function oneByClass(container, classname) {
  return container.getElementsByClassName(classname)[0];
}

function syncTransformsModelWithUI() {
  for (var i = 0; i < transformsContainer.children.length; i++) {
    const el = transformsContainer.children[i];
    const model = userTransforms[i];
    userTransforms[i] =
      _makeTransform(model.type, oneByClass(el, 'chkEnabled').checked,
                     oneByClass(el, 'what').value,
                     model.type == 'replace' ? oneByClass(el, 'replacement').value : null);
  }
}

function redrawTransformsSection() {
  transformsContainer.innerHTML = "";
  for (var i = 0; i < userTransforms.length; i++) {
    const transform = userTransforms[i];
    var newEl = (transform.type == 'replace') ?
        transformReplaceTemplate.cloneNode(true) :
        transformFilterTemplate.cloneNode(true);
    newEl.style = '';
    newEl.internalId = i;

    const what = transform.what;
    if (typeof(what) == 'string')
      oneByClass(newEl, 'what').value = what;
    else
      oneByClass(newEl, 'what').value = what.toString().match(/^(\/.+\/)g?$/)[1];

    if (transform.type == 'replace')
      oneByClass(newEl, 'replacement').value = transform.replacement;
    else if (transform.type == 'remove')
      oneByClass(newEl, 'label').textContent = "Remove:";
    oneByClass(newEl, 'chkEnabled').checked = transform.enabled;

    oneByClass(newEl, 'chkEnabled').internalId = i;
    oneByClass(newEl, 'btnMoveUp').internalId = i;
    oneByClass(newEl, 'btnMoveDown').internalId = i;
    oneByClass(newEl, 'btnClone').internalId = i;
    oneByClass(newEl, 'btnDelete').internalId = i;
    transformsContainer.appendChild(newEl);
  }
}

redrawTransformsSection();

function applyConfiguration() {
  console.time("apply config");
  minPixelsPerFrame = minFrameWidthInPx.value || 0.25;
  normalizeDiff = isNormalized.checked;
  reverseGraph = isReversedInput.checked;
  reverse = reverseGraph;
  syncTransformsModelWithUI();
  refreshData();
  initCanvas();
  render();
  console.timeEnd("apply config");
}

function toggleSidebarVisibility() {
  sidebarVisible = !sidebarVisible;
  let style = oneByClass(document, 'configCol').style
  if (sidebarVisible) {
    style.display = 'block';
    oneByClass(document, 'sidebarToggle').innerText = ">";
  } else {
    style.display = 'none';
    oneByClass(document, 'sidebarToggle').innerText = "<";
  }
  canvasWidth = calculateCanvasWidth();
  applyConfiguration();
}

    </script>
  </body>
</html>
